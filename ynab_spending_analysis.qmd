---
title: "YNAB Budget Analysis: Monthly Spending Trends"
author: "Generated by Databot"
date: today
format: html
execute:
  echo: true
  warning: false
---

::: {.callout-note}
This report was generated using artificial intelligence (Claude from Anthropic) under general human direction. At the time of generation, the contents have not been comprehensively reviewed by a human analyst.

<!--
To indicate human review: Delete the line above about contents not being reviewed, and replace this comment with:
The contents have been reviewed and validated by [Your Name], [Your Role] on [Date].
-->
:::

## Executive Summary

This analysis examines YNAB (You Need A Budget) spending data from March 2024 to February 2025. The key findings include:

- **Average Monthly Expenses**: $5,993 (after cleaning outliers)
- **Average Monthly Income**: $3,636 (flowing through YNAB)
- **Highest Spending Month**: November 2024 ($11,411)
- **Spending Pattern**: Most months show expenses exceeding YNAB-tracked income, suggesting main salary flows to investment accounts first

## Data Loading and Setup

```{python}
import polars as pl
from plotnine import *

# Load the YNAB data files from cache
transactions = pl.read_parquet(".cache/transactions.parquet")
categories = pl.read_parquet(".cache/categories.parquet")
groups = pl.read_parquet(".cache/groups.parquet")

print(f"Original transactions loaded: {len(transactions)}")
print(f"Categories: {len(categories)}")
print(f"Groups: {len(groups)}")
```

## Data Overview

```{python}
# Display basic information about the data
print("Date range in transactions:")
print(f"Earliest: {transactions['date'].min()}")
print(f"Latest: {transactions['date'].max()}")
print(f"Total days: {(transactions['date'].max() - transactions['date'].min()).days}")

print(f"\nTransaction amount range (before cleaning):")
print(f"Min: ${transactions['amount'].min():,.2f}")
print(f"Max: ${transactions['amount'].max():,.2f}")

# Show first few transactions
print("\nFirst 5 transactions:")
transactions.head()
```

## Data Cleaning Process

The raw YNAB data contained several types of system transactions that needed to be filtered out for accurate spending analysis:

```{python}
# Identify outliers - large positive transactions
large_positive = (
    transactions
    .filter(pl.col("amount") > 10000)
    .sort("amount", descending=True)
    .select("date", "amount", "memo", "payee_name", "category_name", "account_name")
)

print(f"Large positive transactions (>$10,000): {len(large_positive)}")
print("These appear to be system entries, not actual income:")
large_positive.head()
```

```{python}
# Filter out outliers and system transactions
filtered_transactions = (
    transactions
    .filter(
        # Remove starting balances and reconciliation adjustments
        ~pl.col("payee_name").str.contains("Starting Balance", literal=True),
        ~pl.col("payee_name").str.contains("Reconciliation Balance", literal=True),
        ~pl.col("payee_name").str.contains("Manual Balance Adjustment", literal=True),
        
        # Remove very large amounts that are likely transfers or system entries
        pl.col("amount").abs() < 10000,
        
        # Remove internal transfers (uncategorized large amounts)
        ~((pl.col("category_name") == "Uncategorized") & (pl.col("amount").abs() > 5000)),
        
        # Remove closed account transactions
        ~pl.col("memo").str.contains("Closed Account", literal=True),
    )
)

print(f"Original transactions: {len(transactions)}")
print(f"Filtered transactions: {len(filtered_transactions)}")
print(f"Removed {len(transactions) - len(filtered_transactions)} outlier transactions")

print(f"\nFiltered amount range:")
print(f"Min: ${filtered_transactions['amount'].min():,.2f}")
print(f"Max: ${filtered_transactions['amount'].max():,.2f}")
```

## Monthly Spending Trends Analysis

```{python}
# Create cleaned monthly spending trends analysis
cleaned_monthly_trends = (
    filtered_transactions
    .with_columns(
        # Create year-month for grouping
        year_month=pl.col("date").dt.strftime("%Y-%m"),
        # Separate income and expenses
        income=pl.when(pl.col("amount") > 0).then(pl.col("amount")).otherwise(0),
        expenses=pl.when(pl.col("amount") < 0).then(pl.col("amount").abs()).otherwise(0)
    )
    .group_by("year_month")
    .agg(
        pl.col("date").min().alias("month_date"),
        pl.col("income").sum().alias("total_income"),
        pl.col("expenses").sum().alias("total_expenses"),
        pl.col("amount").sum().alias("net_flow"),
        pl.len().alias("transaction_count")
    )
    .sort("month_date")
)

print("Monthly spending trends (cleaned data):")
cleaned_monthly_trends
```

## Visualization: Monthly Income vs Expenses

```{python}
# Create visualization data
cleaned_monthly_viz = (
    cleaned_monthly_trends
    .with_columns(
        pl.col("year_month").str.to_date("%Y-%m").alias("month")
    )
    .select(
        "month",
        "total_income", 
        "total_expenses"
    )
    .unpivot(
        index="month",
        on=["total_income", "total_expenses"],
        variable_name="type",
        value_name="amount"
    )
    .with_columns(
        pl.col("type").str.replace("total_", "").str.to_titlecase()
    )
)

# Create the spending trends visualization
p_cleaned = (
    ggplot(cleaned_monthly_viz, aes(x="month", y="amount", color="type"))
    + geom_line(size=1.2)
    + geom_point(size=3)
    + scale_y_continuous(labels=lambda x: [f"${v/1000:.1f}K" for v in x])
    + scale_x_date(date_breaks="1 month", date_labels="%b %Y")
    + labs(
        title="Monthly Income vs Expenses Over Time (Cleaned Data)",
        subtitle="Outliers and system transactions removed",
        x="Month",
        y="Amount ($)",
        color="Type"
    )
    + theme(axis_text_x=element_text(rotation=45, hjust=1))
)

p_cleaned
```

## Key Insights and Summary Statistics

```{python}
# Calculate key metrics for cleaned data
avg_monthly_expenses_clean = cleaned_monthly_trends["total_expenses"].mean()
avg_monthly_income_clean = cleaned_monthly_trends["total_income"].mean()
highest_spending_month_clean = cleaned_monthly_trends.filter(
    pl.col("total_expenses") == pl.col("total_expenses").max()
)
lowest_spending_month_clean = cleaned_monthly_trends.filter(
    pl.col("total_expenses") == pl.col("total_expenses").min()
)

print("ðŸ“Š CLEANED Monthly Spending Analysis (Realistic Values)")
print("=" * 65)
print(f"Average Monthly Expenses: ${avg_monthly_expenses_clean:,.2f}")
print(f"Average Monthly Income: ${avg_monthly_income_clean:,.2f}")
print(f"Average Monthly Deficit: ${avg_monthly_expenses_clean - avg_monthly_income_clean:,.2f}")
print()

print("Highest Spending Month:")
print(f"  {highest_spending_month_clean['year_month'].item()}: ${highest_spending_month_clean['total_expenses'].item():,.2f}")
print()

print("Lowest Spending Month:")
print(f"  {lowest_spending_month_clean['year_month'].item()}: ${lowest_spending_month_clean['total_expenses'].item():,.2f}")
print()

# Show months with positive net flow
positive_months = cleaned_monthly_trends.filter(pl.col("net_flow") > 0)
print(f"Months with positive net flow: {len(positive_months)}")
if len(positive_months) > 0:
    print("Details:")
    for row in positive_months.rows(named=True):
        print(f"  {row['year_month']}: +${row['net_flow']:,.2f}")
```

## Analysis Findings

### Financial Health Overview
- **Average Monthly Expenses**: ${python} f"{avg_monthly_expenses_clean:,.2f}"
- **Average Monthly Income**: ${python} f"{avg_monthly_income_clean:,.2f}" (flowing through YNAB)
- **Monthly Deficit**: ${python} f"{avg_monthly_expenses_clean - avg_monthly_income_clean:,.2f}" on average

### Spending Patterns

1. **Seasonal Spending**: Clear increase in expenses during fall/winter months (Oct-Feb), with November 2024 being the highest spending month at ${python} f"{highest_spending_month_clean['total_expenses'].item():,.2f}".

2. **Income Variability**: YNAB income varies significantly month to month, suggesting:
   - Main salary likely flows directly to investment accounts
   - Variable income sources (bonuses, side income)
   - Irregular transfers to spending accounts

3. **Spending Consistency**: Monthly expenses typically range from ${python} f"{lowest_spending_month_clean['total_expenses'].item():,.2f}" to ${python} f"{highest_spending_month_clean['total_expenses'].item():,.2f}".

4. **Cash Flow Reality**: Most months show a deficit in YNAB, which is normal when main income flows to investment accounts first and spending money is transferred as needed.

### Data Quality Improvements

The analysis removed {python} f"{len(transactions) - len(filtered_transactions)}" outlier transactions, including:
- Starting balance entries from YNAB setup
- Investment account reconciliation adjustments  
- Large account transfers and system entries
- Manual balance adjustments

This filtering revealed the actual day-to-day spending patterns rather than investment movements and system noise.

## Recommendations for Further Analysis

1. **Category-Level Analysis**: Break down spending by YNAB categories to identify specific spending drivers
2. **Seasonal Deep Dive**: Investigate why fall/winter months show higher expenses
3. **Transaction Pattern Analysis**: Examine spending frequency and typical transaction sizes
4. **Budget vs Actual**: Compare planned vs actual spending if budget data is available

## Conclusion

This analysis reveals a person with disciplined spending habits, with monthly expenses ranging from approximately $1,800 to $11,400. The apparent monthly deficit in YNAB is likely by design, representing a system where investment contributions happen first and spending money flows through YNAB for active budget management.

The cleaned data provides a realistic view of actual spending patterns, showing that after removing system entries and outliers, the spending behavior is consistent and manageable within the overall financial framework.